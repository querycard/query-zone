<nav class="fixed top-0 left-0 w-full bg-[#151513] border-b border-gray-700 shadow z-50">
  <div class="max-w-7xl mx-auto px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <div class="flex items-center">
        <h1 class="text-xl font-semibold text-white">
          <span class="text-lime-400">Query</span> Zone
        </h1>
      </div>

      <!-- User Info -->
      <div class="hidden md:flex items-center space-x-6">
        {% if user.is_authenticated %}
          <div class="text-right">
            <div class="text-sm font-medium text-white">{{ name|default:user.username }}</div>
            <div class="text-xs text-gray-400">{{ npm|default:"Student" }} - {{ class|default:"Class" }}</div>
          </div>
          <a href="{% url 'main:logout' %}" class="text-red-400 hover:text-red-500 font-medium transition">
            Logout
          </a>
        {% else %}
          <a href="{% url 'main:login' %}" class="text-white hover:text-lime-400 font-medium transition">
            Login
          </a>
          <a href="{% url 'main:register' %}" class="bg-[#2C2E2A] hover:bg-[#1d1d1b] text-white px-4 py-2 border border-gray-600 rounded-xl font-medium transition">
            Register
          </a>
        {% endif %}
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden flex items-center">
        <button class="mobile-menu-button p-2 text-white hover:text-lime-400 transition">
          <span class="sr-only">Open menu</span>
          <div class="w-6 h-6 flex flex-col justify-center items-center">
            <span class="bg-current block h-0.5 w-6 rounded-sm mb-1"></span>
            <span class="bg-current block h-0.5 w-6 rounded-sm mb-1"></span>
            <span class="bg-current block h-0.5 w-6 rounded-sm"></span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Kategori Horizontal (Desktop & Mobile) -->
  <div class="bg-[#151513] border-t border-gray-700 px-6 py-3">
    <div class="flex flex-wrap gap-2 justify-start">
      {% for category in category %}
        <button
          type="button"
          data-category="{{ category }}"
          class="category-btn px-3 py-1 rounded-xl border border-gray-600 bg-[#2C2E2A] text-white text-sm font-medium hover:bg-[#1d1d1b] capitalize transition"
        >
          {{ category }}
        </button>
      {% endfor %}
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="mobile-menu hidden md:hidden bg-[#151513] border-t border-gray-700 text-white">
    <div class="px-6 py-4 space-y-4">
      <!-- Mobile User Info -->
      <div class="border-t border-gray-700 pt-4">
        {% if user.is_authenticated %}
          <div class="mb-4">
            <div class="font-medium text-white">{{ name|default:user.username }}</div>
            <div class="text-sm text-gray-400">{{ npm|default:"Student" }} - {{ class|default:"Class" }}</div>
          </div>
          <a href="{% url 'main:logout' %}" class="block text-red-400 hover:text-red-500 font-medium py-3 transition">
            Logout
          </a>
        {% else %}
          <a href="{% url 'main:login' %}" class="block text-white hover:text-lime-400 font-medium py-3 transition">
            Login
          </a>
          <a href="{% url 'main:register' %}" class="block bg-[#2C2E2A] hover:bg-[#1d1d1b] text-white font-medium py-3 px-4 border border-gray-600 rounded-xl text-center transition">
            Register
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    const btn = document.querySelector("button.mobile-menu-button");
    const menu = document.querySelector(".mobile-menu");

    btn.addEventListener("click", () => {
      menu.classList.toggle("hidden");
    });

    // === CATEGORY FILTER (AJAX) ===
    function getCategoryFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('category') || '';
    }

    function updateURL(category) {
      const params = new URLSearchParams(window.location.search);
      if (category) {
        params.set('category', category);
      } else {
        params.delete('category');
      }
      const newUrl = `${window.location.pathname}?${params.toString()}`;
      history.pushState({}, '', newUrl);
    }

    function updateActiveCategoryButtons() {
      const selected = getCategoryFromURL();
      document.querySelectorAll('.category-btn').forEach(btn => {
        const cat = btn.dataset.category;
        if (cat === selected) {
          btn.classList.remove('bg-[#2C2E2A]');
          btn.classList.add('bg-[#3D4D29]');
        } else {
          btn.classList.remove('bg-[#3D4D29]');
          btn.classList.add('bg-[#2C2E2A]');
        }
      });
    }

    function initCategoryFilterButtons() {
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const category = btn.dataset.category;
          updateURL(category);
          updateActiveCategoryButtons();
          fetchProductData(); // Panggil AJAX untuk render produk
        });
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      initCategoryFilterButtons();
      updateActiveCategoryButtons();
    });

    window.addEventListener('popstate', () => {
      updateActiveCategoryButtons();
      fetchProductData();
    });
  </script>
</nav>
